name: CI/CD Pipeline for Car Project

on:
  pull_request:
    branches: [ main, master ]
  push:
    branches: [ main, master ]
  workflow_dispatch:  # позволяет запускать вручную

jobs:
  quality-checks:
    name: Code Quality & Tests
    runs-on: ubuntu-latest
    
    steps:
    # 1. Получаем код
    - name: Checkout code
      uses: actions/checkout@v3
      
    # 2. Устанавливаем Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        
    # 3. Устанавливаем инструменты
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install ruff pytest
        
    # 4. Проверяем импорты (опционально, но полезно)
    - name: Check Python imports
      run: |
        python -c "import sys; sys.path.insert(0, 'src'); from car import Car; print('Car class imported successfully')"
        
    # 5. Запускаем линтер Ruff на ВСЕХ файлах в src
    - name: Run Ruff linter
      run: |
        echo "Checking all Python files in src/"
        ruff check --config=ruff.toml ./src/
        
    # 6. Запускаем тесты (они в src/)
    - name: Run Unit Tests
      run: |
        echo "Running tests from src/test_class_car.py"
        cd src
        pytest test_class_car.py -v
        
    # 7. Дополнительная проверка: игнорируем тестовые файлы для основной проверки
    - name: Lint source files only (excluding tests)
      run: |
        echo "Linting source files (excluding test files)"
        ruff check --config=ruff.toml --exclude "*test*.py" ./src/
